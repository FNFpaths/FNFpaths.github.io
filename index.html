<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortnite Festival Paths [BETA]</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Burbank+Big+Condensed:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Fortnite Festival Paths [BETA]</h1>
        <div class="search-box">
            <label for="song-search" hidden>Enter song name:</label>
            <input type="text" id="song-search" placeholder="Search for a song..." oninput="showSuggestions()">
            <div class="suggestions" id="suggestions"></div>
        </div>

        <button id="pro-lead-btn" class="button" style="display: none;">Pro Lead</button>
        <button id="pro-bass-btn" class="button" style="display: none;">Pro Bass</button>

        <div id="song-details" class="song-details">
            <!-- Song details will be displayed here -->
        </div>

        <div class="gpath-container">
            <button id="toggle-g-image-btn" class="button" style="display: none;">Show Path Image</button>
            <div id="g-image-box" style="display: none;">
                <img id="g-image" class="gpImage" alt="Guitar Path Image">
            </div>
        </div>
        
        <!-- New Button and Leaderboard Box -->
        <div class="leaderboard-container">
            <button id="show-b-hiscore-btn" class="button" style="display: none;">Show Leaderboard</button>
            <button id="go-to-top" style="display: none;">Go to Top</button>
            <div id="b-hiscore-box" class="hiscore-box" style="display: none;">
                <div class="scrollable-table-container-b">
                    <table id="b-leaderboard-table">
                        <thead style="text-align: center;">
                            <tr>
                                <th style="padding: 0px 0px; width: 10%; text-align: left;">Rank</th>
                                <th style="padding: 10px 20px; flex-grow: 2;">Player</th>
                                <th style="padding: 10px 20px; width: 20%;">Score</th>
                                <th style="padding: 20px 30px; width: 20%;">Accuracy</th>
                                <th style="padding: 10px 20px; width: 10%;"></th>
                            </tr>
                        </thead>
                        <tbody id="b-hiscore-table" style="text-align: center; padding: 1em;">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    
    </div>

    <script src="fnpv.js"></script>
    <script>
        const leaderboardContainer = document.querySelector('.scrollable-table-container-b');
        const goToTopButton = document.getElementById('go-to-top');
        
        leaderboardContainer.addEventListener('scroll', function () {
            goToTopButton.style.display = leaderboardContainer.scrollTop > 50 ? 'block' : 'none';
        });
        
        goToTopButton.addEventListener('click', function () {
            leaderboardContainer.scrollTo({ top: 0, behavior: 'smooth' });
        });
        
        const searchInput = document.getElementById('song-search');
        const suggestionsBox = document.querySelector('.suggestions');
        
        let currentInstrument = 'g'; // Default to Pro Lead (guitar)
        
        document.getElementById('pro-lead-btn').addEventListener('click', () => {
    currentInstrument = 'g'; // Pro Lead (Guitar)
    if (selectedSong) {
        selectSong(selectedSong); // Update if a song is selected
        fetchLeaderboard(selectedSong.data.shortname); // Fetch leaderboard data for the selected song

        const leaderboardBox = document.getElementById('b-hiscore-box');
        const leaderboardButton = document.getElementById('show-b-hiscore-btn');

        // Close the leaderboard if it's open
        if (leaderboardBox.style.display === 'block') {
            leaderboardBox.style.display = 'none';
            leaderboardButton.textContent = 'Show Leaderboard';
            goToTopButton.style.display = 'none'; // Hide "Go to Top" when leaderboard is hidden
        }
    }
});

document.getElementById('pro-bass-btn').addEventListener('click', () => {
    currentInstrument = 'b'; // Pro Bass
    if (selectedSong) {
        selectSong(selectedSong); // Update if a song is selected
        fetchLeaderboard(selectedSong.data.shortname); // Fetch leaderboard data for the selected song

        const leaderboardBox = document.getElementById('b-hiscore-box');
        const leaderboardButton = document.getElementById('show-b-hiscore-btn');

        // Close the leaderboard if it's open
        if (leaderboardBox.style.display === 'block') {
            leaderboardBox.style.display = 'none';
            leaderboardButton.textContent = 'Show Leaderboard';
            goToTopButton.style.display = 'none'; // Hide "Go to Top" when leaderboard is hidden
        }
    }
});
        
        searchInput.addEventListener('input', function () {
            showSuggestions(this.value);
        });
        
        searchInput.addEventListener('focus', function () {
            setTimeout(() => {
                this.select();
            }, 0);
        });
        
        function showSuggestions(query) {
            const suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = '';
            if (!query) {
                suggestionsDiv.style.display = 'none';
                return;
            }
        
            const filteredSongs = songs.filter(song => song.value.toLowerCase().includes(query.toLowerCase()));
            if (filteredSongs.length > 0) {
                filteredSongs.forEach(song => {
                    const suggestionItem = document.createElement('div');
                    suggestionItem.textContent = song.value;
                    suggestionItem.onclick = () => selectSong(song);
                    suggestionsDiv.appendChild(suggestionItem);
                });
                suggestionsDiv.style.display = 'block';
            } else {
                suggestionsDiv.style.display = 'none';
            }
        }
        
        let selectedSong = null;
        
        function formatPath(path) {
            return path
                .replace(/G/g, '<span style="color:green">G</span>')
                .replace(/R/g, '<span style="color:red">R</span>')
                .replace(/Y/g, '<span style="color:yellow">Y</span>')
                .replace(/B/g, '<span style="color:blue">B</span>')
                .replace(/O/g, '<span style="color:orange">O</span>');
        }
        
        function selectSong(song) {
    selectedSong = song; // Store the selected song for instrument toggle functionality
    const songDetailsDiv = document.getElementById('song-details');
    const suggestionsDiv = document.getElementById('suggestions');
    const searchBox = document.getElementById('song-search');

    searchBox.value = song.value;
    suggestionsDiv.innerHTML = '';

    // Show instrument buttons
    document.getElementById('pro-lead-btn').style.display = 'inline-block';
    document.getElementById('pro-bass-btn').style.display = 'inline-block';

    // Determine which instrument data to use based on the currentInstrument variable
    const path = currentInstrument === 'g' ? song.data.gpath : song.data.bpath;
    const score = currentInstrument === 'g' ? song.data.gscore : song.data.bscore;
    const image = currentInstrument === 'g' ? song.data.g_image : song.data.b_image;

    // Format the path with colors
    const formattedPath = formatPath(path)
        .replace(/, /g, '<br>')
        .replace(/(\d+)\s*([A-Z]+)/g, '$1 $2')
        .replace(/(\d+)\/(\d+)/g, '$1/$2')
        .replace(/\s+/g, ' ');

    const scoreHtml = `<div class="score-box">${score}</div>`;
    const pathHtml = `
        <div class="path-box">
            <img src="img/guitar_tp.png" alt="Pro ${currentInstrument === 'g' ? 'Lead' : 'Bass'}" class="guitar-icon">
            <span class="guitar-text"><b><u>Pro ${currentInstrument === 'g' ? 'Lead' : 'Bass'}</u></b></span> ${scoreHtml} <br>
            ${formattedPath}
        </div>
    `;

    songDetailsDiv.innerHTML = pathHtml;

    // Show the "Show Path Image" button and set its event listener
    document.getElementById('toggle-g-image-btn').style.display = 'block';
    document.getElementById('toggle-g-image-btn').onclick = function () {
        const imageElement = document.getElementById('g-image');
        const isVisible = imageElement.style.display === 'block';
        imageElement.style.display = isVisible ? 'none' : 'block';
        this.textContent = isVisible ? 'Show Path Image' : 'Hide Path Image';
    };

    // Show the path image box
    const gImageBox = document.getElementById('g-image-box');
    gImageBox.style.display = 'block';
    const imageElement = document.getElementById('g-image');
    imageElement.src = 'paths/' + image.replace(/'/g, '');
    imageElement.style.display = 'none';

    // Show the leaderboard button
    const leaderboardButton = document.getElementById('show-b-hiscore-btn');
    leaderboardButton.style.display = 'block';
    leaderboardButton.setAttribute('data-song-id', song.data.shortname);

    console.log('Selected song:', song);
    console.log('Song shortname for leaderboard:', song.data.shortname);
}
        document.getElementById('show-b-hiscore-btn').addEventListener('click', function () {
            const songId = this.getAttribute('data-song-id');
            const leaderboardBox = document.getElementById('b-hiscore-box');
            const button = this;
        
            console.log('Fetching leaderboard for song ID:', songId);
            
            if (button.textContent === 'Show Leaderboard') {
                fetchLeaderboard(songId);
                leaderboardBox.style.display = 'block';
                button.textContent = 'Hide Leaderboard';
            } else {
                leaderboardBox.style.display = 'none';
                goToTopButton.style.display = 'none';
                button.textContent = 'Show Leaderboard';
            }
        });
        
        async function fetchLeaderboard(songId) {
            try {
                const url = `https://raw.githubusercontent.com/mattfreg/FNF_ProLeaderboards/main/leaderboards/season5/${songId}/Solo_Peripheral${currentInstrument === 'g' ? 'Guitar' : 'Bass'}_0.json`;
        
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        
                const data = await response.json();
                if (Array.isArray(data.entries) && data.entries.length > 0) {
                    updateLeaderboardTable(data.entries);
                } else {
                    updateLeaderboardTable([]);
                }
            } catch (error) {
                console.error('Error fetching leaderboard data:', error);
                updateLeaderboardTable([]); // Clear table on error
            }
        }
        
        function updateLeaderboardTable(entries) {
            const tableBody = document.getElementById('b-hiscore-table');
            tableBody.innerHTML = '';
        
            if (entries.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5">No leaderboard data available</td></tr>';
                return;
            }
        
            entries.forEach(entry => {
                const row = document.createElement('tr');
        
                if (entry.rank === 1) {
                    row.style.backgroundColor = 'gold';
                    row.style.color = 'black';
                } else if (entry.rank === 2) {
                    row.style.backgroundColor = 'silver';
                    row.style.color = 'black';
                } else if (entry.rank === 3) {
                    row.style.backgroundColor = '#cd7f32'; // Bronze color
                    row.style.color = 'white';
                } else {
                    row.style.backgroundColor = '#1e1e1e'; // Default background
                    row.style.color = 'white';
                }
        
                row.innerHTML = `
                    <td>${entry.rank || 'N/A'}</td>
                    <td>${entry.userName || 'N/A'}</td>
                    <td>${entry.best_run.score || 'N/A'}</td>
                    <td>${entry.best_run.accuracy !== undefined ? entry.best_run.accuracy + '%' : 'N/A'}</td>
                    <td>${entry.best_run.fullcombo ? 'FC' : ''}</td>
                `;
        
                tableBody.appendChild(row);
            });
        }
        </script>
</body>
</html>
