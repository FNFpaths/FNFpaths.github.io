<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortnite Festival Paths [BETA]</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Burbank+Big+Condensed:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Fortnite Festival Paths [BETA]</h1>
        <div class="search-box">
            <label for="song-search" hidden>Enter song name:</label>
            <input type="text" id="song-search" placeholder="Search for a song..." oninput="showSuggestions()">
            <div class="suggestions" id="suggestions"></div>
        </div>

        <div id="song-details" class="song-details">
            <!-- Song details will be displayed here -->
        </div>

        <div class="gpath-container">
            <button id="toggle-g-image-btn" class="button" style="display: none;">Show Path Image</button>
            <div id="g-image-box" style="display: none;">
                <img id="g-image" class="gpImage" alt="Guitar Path Image">
            </div>
        </div>
        
        <!-- New Button and Leaderboard Box -->
        <div class="leaderboard-container">
            <button id="show-b-hiscore-btn" class="button" style="display: none;">Show Leaderboard</button>
            <button id="go-to-top" style="display: none;">Go to Top</button>
            <div id="b-hiscore-box" class="hiscore-box" style="display: none;">
                <div class="scrollable-table-container-b">
                    <table id="b-leaderboard-table">
                        <thead style="text-align: center;">
                            <tr>
                                <th style="padding: 0px 0px; width: 10%; text-align: left;">Rank</th>
                                <th style="padding: 10px 20px; flex-grow: 2;">Player</th>
                                <th style="padding: 10px 20px; width: 20%;">Score</th>
                                <th style="padding: 20px 30px; width: 20%;">Accuracy</th>
                                <th style="padding: 10px 20px; width: 10%;"></th>
                            </tr>
                        </thead>
                        <tbody id="b-hiscore-table" style="text-align: center; padding: 1em;">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    
    </div>

    <script src="fnpv.js"></script>
    <script>
const leaderboardContainer = document.querySelector('.scrollable-table-container-b');
const goToTopButton = document.getElementById('go-to-top');

leaderboardContainer.addEventListener('scroll', function() {
    if (leaderboardContainer.scrollTop > 50) { // Show button after scrolling down 50px
        goToTopButton.style.display = 'block';
    } else {
        goToTopButton.style.display = 'none';
    }
});

goToTopButton.addEventListener('click', function() {
    leaderboardContainer.scrollTo({ top: 0, behavior: 'smooth' }); // Smooth scroll to top of the container
});
const searchInput = document.getElementById('song-search');
const suggestionsBox = document.querySelector('.suggestions');

searchInput.addEventListener('input', function() {
    showSuggestions(this.value);
});

searchInput.addEventListener('focus', function() {
    setTimeout(() => {
        this.select();  // Keep selecting the text in the search bar
    }, 0);
});

function showSuggestions(query) {
    const suggestionsDiv = document.getElementById('suggestions');
    suggestionsDiv.innerHTML = ''; // Clear previous suggestions

    if (!query) {
        suggestionsDiv.style.display = 'none';
        return;
    }

    // Filter songs based on search input
    const filteredSongs = songs.filter(song => song.value.toLowerCase().includes(query.toLowerCase()));

    if (filteredSongs.length > 0) {
        filteredSongs.forEach(song => {
            const suggestionItem = document.createElement('div');
            suggestionItem.textContent = song.value;
            suggestionItem.onclick = () => selectSong(song);
            suggestionsDiv.appendChild(suggestionItem);
        });
        suggestionsDiv.style.display = 'block';  // Show suggestions
    } else {
        suggestionsDiv.style.display = 'none';  // Hide if no suggestions
    }
}
        document.getElementById('song-search').addEventListener('focus', function() {
    setTimeout(() => {
        this.select();
    }, 0); // Delay the selection to make sure it happens after the focus event finishes
});

        // Function to format the path with colors
        function formatPath(path) {
            return path
                .replace(/G/g, '<span style="color:green">G</span>')
                .replace(/R/g, '<span style="color:red">R</span>')
                .replace(/Y/g, '<span style="color:yellow">Y</span>')
                .replace(/B/g, '<span style="color:blue">B</span>')
                .replace(/O/g, '<span style="color:orange">O</span>');
        }

        function selectSong(song) {
            const songDetailsDiv = document.getElementById('song-details');
            const suggestionsDiv = document.getElementById('suggestions');
            const searchBox = document.getElementById('song-search');

            searchBox.value = song.value;
            suggestionsDiv.innerHTML = '';

            // Format the Guitar Path with colors
            const formattedGpath = formatPath(song.data.gpath)
                .replace(/, /g, '<br>')
                .replace(/(\d+)\s*([A-Z]+)/g, '$1 $2')
                .replace(/(\d+)\/(\d+)/g, '$1/$2')
                .replace(/\s+/g, ' ');

            // Prepare the Guitar text with bold, underscore, and score in gold box
            const scoreHtml = `<div class="score-box">${song.data.gscore}</div>`;
            const pathHtml = `
             <div class="path-box">
                <img src="img/guitar_tp.png" alt="Pro Lead" class="guitar-icon">
                <span class="guitar-text"><b><u>Pro Lead</u></b></span> ${scoreHtml} <br>
                ${formattedGpath}
            </div>
            `;

            // Insert the formatted data into the song details
            songDetailsDiv.innerHTML = pathHtml;

            // Show the "Show Path Image" button and set its event listener
            document.getElementById('toggle-g-image-btn').style.display = 'block';
            document.getElementById('toggle-g-image-btn').onclick = function() {
                const image = document.getElementById('g-image');
                const isVisible = image.style.display === 'block';
                image.style.display = isVisible ? 'none' : 'block';
                this.textContent = isVisible ? 'Show Path Image' : 'Hide Path Image';
            };

            // Show the path image box
            const gImageBox = document.getElementById('g-image-box');
            gImageBox.style.display = 'block';
            const image = document.getElementById('g-image');
            image.src = 'paths/' + song.data.g_image.replace(/'/g, '');
            image.style.display = 'none'; // Start hidden

            // Show the leaderboard button
            const leaderboardButton = document.getElementById('show-b-hiscore-btn');
            leaderboardButton.style.display = 'block';
            leaderboardButton.setAttribute('data-song-id', song.data.shortname);

            console.log('Selected song:', song);  // Debugging line to check song data
            console.log('Song shortname for leaderboard:', song.data.shortname);  // Debugging line
        }

        document.getElementById('show-b-hiscore-btn').addEventListener('click', function() {
            const songId = this.getAttribute('data-song-id');
            console.log('Fetching leaderboard for song ID:', songId);  // Debugging line
            const leaderboardBox = document.getElementById('b-hiscore-box');
            const button = this;

            if (button.textContent === 'Show Leaderboard') {
                GetGuitarLeaderboard(songId);  // Fetch leaderboard using songId
                leaderboardBox.style.display = 'block';
                button.textContent = 'Hide Leaderboard';
            } else {
                leaderboardBox.style.display = 'none';
                goToTopButton.style.display = 'none';  // Hide "Go to Top" when leaderboard is hidden
                button.textContent = 'Show Leaderboard';
            }
        });

        async function GetGuitarLeaderboard(songId) {
            try {
                const url = `https://raw.githubusercontent.com/mattfreg/FNF_ProLeaderboards/main/leaderboards/season5/${songId}/Solo_PeripheralGuitar_0.json`;
                console.log(`Fetching leaderboard from URL: ${url}`);

                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Fetched leaderboard data:', data);  // Log the data to check structure

                if (Array.isArray(data.entries) && data.entries.length > 0) {
                    updateGuitarLeaderboardTable(data.entries);
                } else {
                    console.warn('Leaderboard data is empty or not in expected format:', data);
                    updateGuitarLeaderboardTable([]); // Clear the table if no valid data
                }
            } catch (error) {
                console.error('Error fetching leaderboard data:', error);
            }
        }
        function updateGuitarLeaderboardTable(entries) {
    const tableBody = document.getElementById('b-hiscore-table');
    tableBody.innerHTML = ''; // Clear existing rows

    if (entries.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="5">No leaderboard data available</td></tr>';
        return;
    }

    entries.forEach(entry => {
        const row = document.createElement('tr');

        // Apply colors based on rank
        if (entry.rank === 1) {
            row.style.backgroundColor = 'gold';
            row.style.color = 'black'; // Ensure readability on gold background
        } else if (entry.rank === 2) {
            row.style.backgroundColor = 'silver';
            row.style.color = 'black'; // Ensure readability on silver background
        } else if (entry.rank === 3) {
            row.style.backgroundColor = '#cd7f32'; // Bronze color
            row.style.color = 'white'; // Ensure readability on bronze background
        } else {
            row.style.backgroundColor = '#1e1e1e'; // Default background for other ranks
            row.style.color = 'white'; // Default text color
        }

        row.innerHTML = `
            <td>${entry.rank || 'N/A'}</td>
            <td>${entry.userName || 'N/A'}</td>
            <td>${entry.best_run.score || 'N/A'}</td>
            <td>${entry.best_run.accuracy !== undefined ? entry.best_run.accuracy + '%' : 'N/A'}</td>
            <td>${entry.best_run.fullcombo ? 'FC' : ''}</td>
        `;
        
        tableBody.appendChild(row);
    });
}
    </script>
</body>
</html>
